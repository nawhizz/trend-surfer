# 🌊 추세추종 전략 (Trend Following Strategy) 상세 가이드

본 문서는 현재 시스템에 구현된 **추세추종 전략의 모든 규칙**을 정리한 문서입니다.
HTS/MTS 차트와 대조하여 실제 매매 시점을 검증할 때 사용하십시오.

---

## 1. 차트 설정 (Indicators Setup)

검증을 위해 차트에 아래 지표를 추가해야 합니다.

| 지표명 | 설정값 (Period) | 용도 |
| :--- | :--- | :--- |
| **가격 채널 (Price Channel)** | **20일** (High) | 진입 신호 (20일 신고가 돌파 확인용) |
| **가격 채널 (Price Channel)** | **10일** (High) | **불타기** 진입 신호 |
| **지수이동평균 (EMA)** | **50일** | 추세 필터 (가격이 이 위에 있어야 함) |
| **이동평균 스테이지 (EMA STAGE)** | **5, 20, 40일** | 시장 국면 분석 (1~6단계 구분) |
| **평균진폭 (ATR)** | **20일** | 손절가 및 트레일링 스탑 계산용 |

> *   캔들이 **20일 고가 라인**을 뚫고 올라가는 순간이 **매수 타이밍**입니다.
> *   단, 캔들이 **50일 EMA**보다 위에 있어야 합니다.

### 1.1 이동평균선 대순환 스테이지 (EMA Stage)
고지로 강사의 대순환 분석법을 적용하여 5일(단기), 20일(중기), 40일(장기) EMA 배열에 따라 현재 상태를 진단합니다.

| Stage | 명칭 | 상태 (배열) | 설명 |
|:---:|:---:|---|---|
| **1** | **안정 상승기** | 단기 > 중기 > 장기 | 가장 안정적인 수익 구간 (보유) |
| **2** | 하락 변화기 1 | 중기 > 단기 > 장기 | 단기 하락 시작 (주의) |
| **3** | 하락 변화기 2 | 중기 > 장기 > 단기 | 하락 전환 (매도) |
| **4** | **안정 하락기** | 장기 > 중기 > 단기 | 완전한 역배열 (관망) |
| **5** | 상승 변화기 1 | 장기 > 단기 > 중기 | 바닥 다지기 (매수 준비) |
| **6** | **상승 변화기 2** | 단기 > 장기 > 중기 | 상승 전환 초입 (선취매 기회) |

> **💡 전략 활용**:
> *   **Stage 1**이 지속될 때 추세추종 전략이 가장 잘 작동합니다.
> *   **Stage 6**은 Stage 1로 가기 직전의 '골든크로스' 구간으로, 조기 진입 신호로 해석할 수 있습니다.

---

## 2. 진입 규칙 (Entry Rules)

아래 조건을 **모두 만족하는 날의 다음 날 시가(Open)**에 매수합니다.

### A. 기본 진입 (Initial Entry)
1.  **신고가 갱신**: 오늘의 종가가 최근 **20일 최고가(`HIGH_20`)**보다 높아야 합니다.
2.  **추세 필터**: 오늘의 종가가 **50일 EMA**보다 위에 있어야 합니다.
3.  **기울기 필터**: 50일 EMA의 기울기가 **-0.2 이상**이어야 합니다. (급격한 하락 추세 아님)
4.  **과열 방지**: `ATR(20) / 종가` 비율이 **15% 이하**여야 합니다. (변동성이 너무 극심하면 진입 금지)

### B. 재진입 (Re-entry)
한 번 청산(익절/손절)한 종목을 다시 살 때의 규칙입니다.
1.  **쿨타임**: 청산 후 **최소 3 거래일**이 지나야 합니다. (바로 다음날 진입 금지)
2.  **조건 충족**: 위의 '기본 진입' 조건을 다시 만족해야 합니다. (다시 20일 신고가 돌파)
    *   *참고: 과거에는 손절 후 재진입이 금지되었으나, 현재는 **허용**됩니다.*

### C. 불타기 (Pyramiding)
이미 수익 중일 때 추가로 더 사는 규칙입니다. (최대 3회)
1.  **수익 확보**: 기존 포지션이 **최소 1R(손절폭 만큼의 수익)** 이상 구간이어야 합니다.
2.  **신호 발생**: **10일 신고가(`HIGH_10`)** 또는 **20일 신고가**를 다시 돌파해야 합니다.
3.  **리스크 관리**: 추가 매수 시 **새로운 손절폭**이 기존보다 작거나 같아야 합니다.

---

## 3. 청산 규칙 (Exit Rules)

보유 중인 종목을 언제 파는지에 대한 규칙입니다.

### A. 손절매 (Stop Loss) - "생명선"
*   **기준**: 진입가에서 **`2 x ATR`** 만큼 하락하면 즉시 매도합니다.
*   *예시: 진입가 10,000원, ATR 500원 -> 손절가 9,000원*

### B. 트레일링 스탑 (Trailing Stop) - "수익 보존"
주가가 오르면 익절 라인도 같이 따라 올립니다.
*   **기준**: (보유 기간 중) **최고 종가(Highest Close)**에서 **`2.5 x ATR`** 만큼 하락하면 매도합니다.
*   *특징: 주가가 오르면 익절가도 같이 오르지만, 주가가 내려도 익절가는 내려가지 않습니다.*

---

## 4. 자금 관리 (Money Management)

실제 몇 주를 매수할지 결정하는 **가장 중요한 로직**입니다.

### 1% 룰 (The 1% Rule)
*   어떤 거래든 손절을 당했을 때, **총 자산의 1%만 잃도록** 수량을 조절합니다.
*   **공식**:
    $$ 매수수량 = \frac{총 자산 \times 0.01}{진입가 - 손절가(= 2 \times ATR)} $$

> **💡 실제 현상**:
> *   변동성이 큰 종목(ATR 큼)은 **적게** 삽니다.
> *   변동성이 작은 종목(ATR 작음)은 **많이** 삽니다.
> *   자산이 늘어나면 배팅 금액도 커집니다. (복리 효과)

### 계산 예시 (2025-01-17 효성중공업)
*   **자본금**: 100,000,000원
*   **리스크 금액 (1R)**: 1,000,000원 (1%)
*   **진입가**: 470,000원
*   **손절가**: 422,430원 (ATR 2배 적용)
*   **주당 손실폭**: 47,570원
*   **매수 수량**: 1,000,000 / 47,570 = **21주** (소수점 내림)

> *주가가 급등하여 변동성이 커지면 수량은 자동으로 줄어듭니다. (예: 주가 209만원 시 5주 매수)*

---

## 5. 방어 기제 (Defense Mechanism)

### A. 시장 필터 (Market Filter)
시장 전체가 폭락장일 때는 개별 종목 신호가 나와도 무시합니다.
*   **조건**: KOSPI 또는 KOSDAQ 지수의 **50일 EMA 기울기**가 심하게 꺾였을 때 (-0.2 미만)
*   *참고: 현재는 꽤 관대하게 설정되어 있어 약세장에서도 주도주는 매매합니다.*

### B. 킬 스위치 (Kill Switch)
계좌가 망가지고 있다고 판단되면 매매를 **강제 중단**합니다.
*   **발동 조건**: 최근 10번 매매 중 **8번 이상 손실** 발생.
*   **효과**: 모든 신규 진입이 차단됩니다. (보유 종목 청산은 가능)
*   **해제(Reset)**: 발동 후 **20 거래일(약 1달)**이 지나면 자동으로 해제되어 매매를 재개합니다.

### C. 종목 제외 필터 (Stock Exclusion Filter)
매매 대상에서 다음 종목들은 자동으로 제외됩니다. (키움증권 API 연동)
*   **관리종목 (ADMIN)**: 상장폐지 사유 발생 종목
*   **환기종목 (CAUTION)**: 투자주의 환기 필요 종목
*   **거래정지 (HALT)**: 일시 거래 중단 종목
*   **우선주**: 보통주만 매매
*   **ETF/ETN/스팩**: 일반 주식만 매매

----------------------------------------------------------------
**[요약] 차트 대조 체크리스트**
1. [ ] **매수 시점**: 캔들이 20일 고점 선을 뚫었는가? (아래에 50일 이평선이 있는가?)
2. [ ] **매도 시점**: 주가가 고점 대비 일정 폭(ATR 2.5배) 이상 하락했는가?
3. [ ] **매수 안 함**: 혹시 3일 전에 팔았는가? (쿨타임)
4. [ ] **매수 안 함**: 혹시 최근에 계속 손절만 당했는가? (킬 스위치)
5. [ ] **매수 안 함**: 관리종목/거래정지/환기종목 여부 확인
